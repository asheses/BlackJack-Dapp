(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{33512:(e,t,n)=>{Promise.resolve().then(n.bind(n,79709))},79709:(e,t,n)=>{"use strict";n.d(t,{default:()=>w});var a=n(95155),s=n(76046),l=n(12115),i=n(32438),r=n(31081),u=n(21065);let d=JSON.parse('{"HV":[{"inputs":[{"internalType":"address","name":"target","type":"address"}],"name":"AddressEmptyCode","type":"error"},{"inputs":[{"internalType":"address","name":"implementation","type":"address"}],"name":"ERC1967InvalidImplementation","type":"error"},{"inputs":[],"name":"ERC1967NonPayable","type":"error"},{"inputs":[],"name":"EnforcedPause","type":"error"},{"inputs":[],"name":"ExpectedPause","type":"error"},{"inputs":[],"name":"FailedCall","type":"error"},{"inputs":[],"name":"InvalidInitialization","type":"error"},{"inputs":[],"name":"NotInitializing","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"inputs":[],"name":"UUPSUnauthorizedCallContext","type":"error"},{"inputs":[{"internalType":"bytes32","name":"slot","type":"bytes32"}],"name":"UUPSUnsupportedProxiableUUID","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"components":[{"internalType":"uint8[6]","name":"userCards","type":"uint8[6]"},{"internalType":"uint8[6]","name":"dealerCards","type":"uint8[6]"},{"internalType":"uint8","name":"dealerCount","type":"uint8"},{"internalType":"uint8","name":"userCount","type":"uint8"},{"internalType":"bool","name":"isGameStart","type":"bool"},{"internalType":"uint256","name":"stakes","type":"uint256"},{"internalType":"uint256","name":"winCounts","type":"uint256"},{"internalType":"uint256","name":"gameCounts","type":"uint256"},{"internalType":"uint256","name":"winStakes","type":"uint256"},{"internalType":"int256","name":"totalStakes","type":"int256"}],"indexed":false,"internalType":"struct BlackJack.Game","name":"game","type":"tuple"}],"name":"GameState","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint64","name":"version","type":"uint64"}],"name":"Initialized","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"implementation","type":"address"}],"name":"Upgraded","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"winer","type":"address"},{"indexed":false,"internalType":"uint8","name":"dealerValue","type":"uint8"},{"indexed":false,"internalType":"uint8","name":"userValue","type":"uint8"}],"name":"Win","type":"event"},{"stateMutability":"payable","type":"fallback"},{"inputs":[],"name":"UPGRADE_INTERFACE_VERSION","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"consoleLog","outputs":[],"stateMutability":"view","type":"function"},{"inputs":[],"name":"deposit","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"getContractBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getGame","outputs":[{"components":[{"internalType":"uint8[6]","name":"userCards","type":"uint8[6]"},{"internalType":"uint8[6]","name":"dealerCards","type":"uint8[6]"},{"internalType":"uint8","name":"dealerCount","type":"uint8"},{"internalType":"uint8","name":"userCount","type":"uint8"},{"internalType":"bool","name":"isGameStart","type":"bool"},{"internalType":"uint256","name":"stakes","type":"uint256"},{"internalType":"uint256","name":"winCounts","type":"uint256"},{"internalType":"uint256","name":"gameCounts","type":"uint256"},{"internalType":"uint256","name":"winStakes","type":"uint256"},{"internalType":"int256","name":"totalStakes","type":"int256"}],"internalType":"struct BlackJack.Game","name":"","type":"tuple"},{"internalType":"uint8","name":"","type":"uint8"},{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getPlayers","outputs":[{"components":[{"internalType":"uint8[6]","name":"userCards","type":"uint8[6]"},{"internalType":"uint8[6]","name":"dealerCards","type":"uint8[6]"},{"internalType":"uint8","name":"dealerCount","type":"uint8"},{"internalType":"uint8","name":"userCount","type":"uint8"},{"internalType":"bool","name":"isGameStart","type":"bool"},{"internalType":"uint256","name":"stakes","type":"uint256"},{"internalType":"uint256","name":"winCounts","type":"uint256"},{"internalType":"uint256","name":"gameCounts","type":"uint256"},{"internalType":"uint256","name":"winStakes","type":"uint256"},{"internalType":"int256","name":"totalStakes","type":"int256"}],"internalType":"struct BlackJack.Game[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getPlayersIndex","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"hit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"initGame","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"isEndGame","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"playerIndex","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"proxiableUUID","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newImplementation","type":"address"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"upgradeToAndCall","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"userGame","outputs":[{"internalType":"uint8","name":"dealerCount","type":"uint8"},{"internalType":"uint8","name":"userCount","type":"uint8"},{"internalType":"bool","name":"isGameStart","type":"bool"},{"internalType":"uint256","name":"stakes","type":"uint256"},{"internalType":"uint256","name":"winCounts","type":"uint256"},{"internalType":"uint256","name":"gameCounts","type":"uint256"},{"internalType":"uint256","name":"winStakes","type":"uint256"},{"internalType":"int256","name":"totalStakes","type":"int256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}]}');var o=n(11326),p=n(48713),m=n(74046),c=n(69595),y=n(68037),x=n(5565);let b=e=>{let{cards:t=[]}=e,n=[...t];for(;n.length<2;)n.push(-1);return(0,a.jsx)("div",{className:"flex flex-wrap justify-center gap-6 m-4",children:n.map((e,t)=>(0,a.jsx)("div",{className:"relative w-32 h-48 rounded-2xl overflow-hidden shadow-2xl transform transition-all duration-300 hover:scale-105",children:-1===e?(0,a.jsx)("div",{className:"relative w-full h-full",children:(0,a.jsx)(x.default,{src:"/Cards/background.jpg",alt:"",layout:"fill",objectFit:"cover",className:"rounded-2xl"})}):e%4==0?(0,a.jsx)("div",{className:"relative w-full h-full",children:(0,a.jsx)(x.default,{src:"/Cards/cardSpades".concat(Math.floor(e/4)+1,".png"),alt:"",layout:"fill",objectFit:"cover",className:"rounded-2xl"})}):e%4==1?(0,a.jsx)("div",{className:"relative w-full h-full",children:(0,a.jsx)(x.default,{src:"/Cards/cardHearts".concat(Math.floor(e/4)+1,".png"),alt:"",layout:"fill",objectFit:"cover",className:"rounded-2xl"})}):e%4==2?(0,a.jsx)("div",{className:"relative w-full h-full",children:(0,a.jsx)(x.default,{src:"/Cards/cardDiamonds".concat(Math.floor(e/4)+1,".png"),alt:"",layout:"fill",objectFit:"cover",className:"rounded-2xl"})}):(0,a.jsx)("div",{className:"relative w-full h-full",children:(0,a.jsx)(x.default,{src:"/Cards/cardClubs".concat(Math.floor(e/4)+1,".png"),alt:"",layout:"fill",objectFit:"cover",className:"rounded-2xl"})})},t))})},f=e=>{let{playersData:t,playerAddress:n,page:s}=e,l=n.map(e=>e.substring(0,6)+"..."+e.substring(e.length-4)),i=[];for(let e=0;e<t.length;e++){var r,u;i.push({address:l[e],winCounts:Number((null===(r=t[e])||void 0===r?void 0:r.winCounts)||0),winStakes:Number((null===(u=t[e])||void 0===u?void 0:u.winStakes)||0)})}i.sort((e,t)=>t.winCounts-e.winCounts);let d=i.slice((s-1)*10,10*s);return(0,a.jsx)("div",{className:"flex w-full flex-col gap-1 h-[440px] ",children:d.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-around w-full border-2 border-gray-400 rounded-lg p-2 text-sm h-9",children:[(0,a.jsx)("div",{children:(s-1)*10+t+1}),(0,a.jsx)("div",{children:e.address}),(0,a.jsx)("div",{children:e.winCounts}),(0,a.jsx)("div",{children:(e.winStakes/1e18).toFixed(1)})]},t))})};var h=n(93659);function g(){return(0,a.jsxs)("div",{className:"text-lg text-white border-red-600 border-2 rounded-xl bg-fuchsia-800 w-full h-full py-4 px-8",children:[(0,a.jsx)("div",{className:"mt-2 mb-4 text-3xl bg-gradient-to-r from-lime-200 to-emerald-400 bg-clip-text text-transparent font-bold",children:"♠ GameGuide"}),(0,a.jsx)("p",{className:"mt-2 mb-4 text-1xl bg-gradient-to-r from-lime-200 to-emerald-400 bg-clip-text text-transparent font-bold my-3",children:"使用钱包登录，向临时钱包转账一定金额开始游戏。"}),(0,a.jsx)("p",{className:"mt-2 mb-4 text-1xl bg-gradient-to-r from-lime-200 to-emerald-400 bg-clip-text text-transparent font-bold my-3",children:"选择筹码大小，最小下注金额为0.01，最大下注金额庄家资金的1/10，点击新游戏即可开始游戏。"}),(0,a.jsx)("p",{className:"mt-2 mb-4 text-1xl bg-gradient-to-r from-lime-200 to-emerald-400 bg-clip-text text-transparent font-bold my-3",children:"点击要牌，摸一张牌，点击结束，计算结果。"}),(0,a.jsx)("p",{className:"mt-2 mb-4 text-1xl bg-gradient-to-r from-lime-200 to-emerald-400 bg-clip-text text-transparent font-bold my-3",children:"2-10按面值，J/Q/K为10点，A可作1或11点，当点数大于庄家且未爆牌时，玩家获胜！"})]})}function v(){let{sendTransaction:e}=(0,r.s)(),{authenticated:t,user:n,ready:s}=(0,i.m)(),[x,v]=(0,l.useState)("..."),w=(null==n?void 0:n.linkedAccounts.filter(e=>"wallet"===e.type).map(e=>e.address)[1])||"",C="0xec2A2F1AD0c78097d71E8a28357523485C74e071",[j,T]=(0,l.useState)("0.1"),N={showWalletUIs:!1},[k,S]=(0,l.useState)([]),[M,G]=(0,l.useState)(["0x1234567890123456789012345678901234567890"]),{wallets:E}=(0,u.S)(),[O,V]=(0,l.useState)(null),[I,F]=(0,l.useState)(null),[U,P]=(0,l.useState)({dealerCards:[-1,-1],userCards:[-1,-1],dealerCount:1,userCount:2,isGameStart:!1,stakes:0,winCounts:0,gameCounts:0,winStakes:0,totalStakes:0,dealerValue:0,userValue:0}),A=(0,o.l)({chain:y.F,transport:(0,p.L)()}),_=async()=>{try{let e=await A.readContract({address:C,abi:d.HV,functionName:"getGame",args:[w]}),t=function(e){let[t,n,a]=e;return{dealerCards:t.dealerCards.slice(0,t.dealerCount),userCards:t.userCards.slice(0,t.userCount),dealerCount:t.dealerCards.length,userCount:t.userCards.length,isGameStart:t.isGameStart,stakes:Number(t.stakes),winCounts:t.winCounts,gameCounts:Number(t.gameCounts),winStakes:t.winStakes,totalStakes:t.totalStakes,dealerValue:n,userValue:a}}(e);P(t)}catch(e){console.error("获取当局游戏信息失败:",e)}};(0,l.useEffect)(()=>{t&&_()},[t]);let D=async()=>{try{let e=await A.readContract({address:C,abi:d.HV,functionName:"getPlayersIndex",args:[]});G(e)}catch(e){console.error("获取所有玩家信息失败:",e)}},z=async()=>{try{let e=await A.readContract({address:C,abi:d.HV,functionName:"getPlayers",args:[]});S(e)}catch(e){console.error("获取所有玩家信息失败:",e)}};(0,l.useEffect)(()=>{z(),D()},[U.isGameStart,t]);let[B,R]=(0,l.useState)(1),H=async n=>{if(!t&&s)return alert("请先登录");v("loading...");let a=(0,m.p)({abi:d.HV,functionName:n,args:[]}),l={to:C,value:"initGame"===n?BigInt(1e18*Number(j)):0,data:a};try{let{hash:t}=await e(l,{uiOptions:N}),n=await A.waitForTransactionReceipt({hash:t,confirmations:1,timeout:15e3});if("success"===n.status)await _(),v(t),console.log("交易已确认，哈希:",t);else throw v("交易失败"),Error("交易失败: 状态码 ".concat(n.status))}catch(e){console.error("发送交易失败:",e)}};return(0,l.useEffect)(()=>{(async()=>{if(n&&0!==E.length)try{let e=await A.getBalance({address:w}),t=(0,c.c)(e);V(parseFloat(t).toFixed(2))}catch(e){console.error("获取余额失败:",e),V("0.00")}})(),(async()=>{if(n&&0!==E.length)try{let e=await A.getBalance({address:C});console.log("游戏合约余额:",e);let t=(0,c.c)(e);F(parseFloat(t).toFixed(2))}catch(e){console.error("获取余额失败:",e),F("0.00")}})()},[n,E,A,x]),(0,a.jsxs)("div",{className:"w-full mx-auto flex items-center justify-center gap-2",children:[(0,a.jsx)("div",{className:"flex flex-col items-center w-1/5 min-w-[300px] text-center gap-2 h-full",children:(0,a.jsx)(g,{})}),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-[710px] bg-gradient-to-br from-indigo-900 to-purple-800 p-4 rounded-2xl text-white min-w-[800px]",children:[(0,a.jsxs)("label",{className:"block mb-2 text-pink-400 font-bold text-2xl",children:["庄家分数：",null==U?void 0:U.dealerValue]}),(0,a.jsx)(b,{cards:null==U?void 0:U.dealerCards}),(0,a.jsx)(b,{cards:null==U?void 0:U.userCards}),(0,a.jsxs)("label",{className:"block mb-2 text-lime-300 font-bold text-2xl",children:["玩家分数：",null==U?void 0:U.userValue]}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,a.jsx)("label",{className:"block mb-4 text-2xl text-green-400 font-bold",children:(null==U?void 0:U.isGameStart)?"游戏进行中……":U.dealerCount>6||U.userCount>6||U.userValue>U.dealerValue&&U.userValue<22||U.dealerValue>21&&U.userValue<22?"玩家获胜！":U.dealerValue==U.userValue?"平局！":"庄家获胜！"}),(null==U?void 0:U.isGameStart)?(0,a.jsxs)("label",{className:"block mb-4 text-2xl ",children:["筹码: ",(null==U?void 0:U.stakes)?Number(U.stakes)/1e18:0," (MON)"]}):(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-center",children:[(0,a.jsx)("label",{className:"block text-center text-2xl",children:"筹码 (MON)"}),(0,a.jsx)("input",{type:"number",value:j,onChange:e=>T(e.target.value),className:"p-1 rounded text-black w-20 ml-3 text-base",step:"0.01",min:"0.01"})]})]}),(0,a.jsxs)("div",{className:"flex gap-4 justify-between text-xl",children:[(0,a.jsx)("button",{onClick:()=>H("initGame"),className:" bg-blue-500 text-amber-100 py-2 px-4 rounded hover:bg-blue-600 disabled:bg-gray-400 ",disabled:(null==U?void 0:U.isGameStart)||"loading..."==x,children:"新游戏"}),(0,a.jsx)("button",{onClick:()=>H("hit"),className:" bg-blue-500 text-amber-100 py-2 px-4 rounded hover:bg-blue-600 disabled:bg-gray-400",disabled:!(null==U?void 0:U.isGameStart)||"loading..."==x,children:"要牌"}),(0,a.jsx)("button",{onClick:()=>H("isEndGame"),className:" bg-blue-500 text-amber-100 py-2 px-4 rounded hover:bg-blue-600 disabled:bg-gray-400",disabled:!(null==U?void 0:U.isGameStart)||"loading..."==x,children:"结束"})]}),x&&(0,a.jsx)("div",{className:"mt-4 p-2 bg-green-100 rounded",children:(0,a.jsx)("a",{href:"https://testnet.monadexplorer.com/address/".concat(x),target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline break-all",children:"0x"===x.slice(0,2)?"查看交易:".concat(x.slice(0,12),"...").concat(x.slice(-10)):x})})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center w-1/5 min-w-[300px] text-center gap-2 h-full",children:[(0,a.jsxs)("div",{className:"text-lg text-white border-red-600 border-2 font-bold rounded-xl bg-fuchsia-800 w-full h-auto p-3",children:["玩家余额：",O," MON"]}),(0,a.jsxs)("div",{className:"text-lg text-white border-red-600 border-2 font-bold rounded-xl bg-fuchsia-800 w-full h-auto p-3",children:["庄家资金：",I," MON"]}),(0,a.jsxs)("div",{className:"text-lg text-white border-red-600 border-2 rounded-xl bg-fuchsia-800 w-full h-[580px] p-3  gap-2 flex flex-col items-center",children:[(0,a.jsxs)("div",{className:"gap-2 justify-end flex w-full",children:[(0,a.jsx)("div",{className:"mr-10",children:"\uD83C\uDFC6"}),(0,a.jsx)("div",{className:"mr-5",children:"玩家"}),(0,a.jsx)("div",{children:"胜场"}),(0,a.jsx)("div",{children:"赢得(MON)"})]}),(0,a.jsxs)("div",{className:"flex justify-between w-full border-4 rounded-lg p-2 text-m h-12 border-emerald-300 text-emerald-200",children:[(0,a.jsx)("div",{children:"当前玩家"}),(0,a.jsxs)("div",{children:[w.substring(0,6),"...",w.substring(w.length-4)]}),(0,a.jsx)("div",{children:null==U?void 0:U.winCounts}),(0,a.jsx)("div",{children:Number(null==U?void 0:U.winStakes)/1e18})]}),(0,a.jsx)(f,{playersData:k,playerAddress:M,page:B}),(0,a.jsx)(h.A,{onChange:e=>{R(e)},pageSize:10,simple:{readOnly:!0},defaultCurrent:1,total:M.length,className:"bg-gray-300 rounded-xl font-bold w-auto h-10 p-3 text-lg items-center justify-center"})]})]})]})}function w(){let e=(0,s.useRouter)(),{ready:t,authenticated:n}=(0,i.m)();return(0,l.useEffect)(()=>{t&&!n&&e.push("/")},[t,n,e]),(0,a.jsx)("main",{className:"flex flex-col px-4 sm:px-20 py-6 sm:py-10 bg-purple-400 h-[900px] w-full min-w-[1400px]",children:(0,a.jsx)(v,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[878,440,441,517,358],()=>t(33512)),_N_E=e.O()}]);